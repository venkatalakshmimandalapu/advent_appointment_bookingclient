<div class="app-nav">
    <img src="home.png" (click)="goHome()" id="homebutton" title="home">
    <img src="logout.png" (click)="logout()" id="logoutbutton" title="logout">
</div>

<div class="appointment-container">
    <h2>Existing Appointments</h2>

    <div *ngIf="isLoading">Loading appointments...</div>
    <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

    <div class="filter-container">
        <div class="filter-item">
            <label for="searchBox">Search Appointments:</label>
            <input type="text" id="searchBox" [(ngModel)]="searchTerm" (input)="applyFilters()" placeholder="Search by any field..." />
        </div>

        <div class="filter-item">
            <label for="datePicker">Filter Appointments by Date:</label>
            <input type="date" id="datePicker" [(ngModel)]="selectedDate" (change)="applyFilters()" />
        </div>

        <div class="filter-item">
            <label for="statusFilter">Filter by Status:</label>
            <select id="statusFilter" [(ngModel)]="selectedStatus" (change)="applyFilters()">
                <option value="">All</option>
                <option value="Scheduled">Scheduled</option>
                <option value="Approved">Approved</option>
                <option value="Canceled">Canceled</option>
            </select>
        </div>
    </div>

    <p-table
        [value]="filteredAppointments"
        [paginator]="true"
        [rows]="itemsPerPage"
        [lazy]="true"
        (onLazyLoad)="loadAppointments($event)"
        [totalRecords]="totalRecords"
        [loading]="isLoading"
    >
        <ng-template pTemplate="header">
            <tr>
                <th>Ticket Number</th>
                <th>Move Type</th>
                <th>Container Number</th>
                <th (click)="toggleSortOrder('sizeType')">Size Type</th>
                <th>Line</th>
                <th>Chassis No</th>
                <th>Appointment Status</th>
                <th>Gate Code</th>
                <th (click)="toggleSortOrder('appointmentId')">ApId</th>
                <th>Actions</th>
            </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-appointment>
            <tr>
                <td>{{ appointment.ticketNumber }}</td>
                <td>{{ appointment.moveType }}</td>
                <td>{{ appointment.containerNumber }}</td>
                <td>{{ appointment.sizeType }}</td>
                <td>{{ appointment.line }}</td>
                <td>{{ appointment.chassisNo }}</td>
                <td>{{ appointment.appointmentStatus }}</td>
                <td>{{ appointment.gateCode }}</td>
                <td>{{ appointment.appointmentId }}</td>
                <td>
                    <button (click)="deleteAppointment(appointment.appointmentId)">Delete Appointment</button>
                </td>
            </tr>
        </ng-template>
        
        <ng-template pTemplate="footer">
            <tr *ngIf="filteredAppointments.length === 0 && !isLoading">
                <td colspan="10" style="text-align: center;">No appointments available.</td>
            </tr>
        </ng-template>
    </p-table>
</div>
